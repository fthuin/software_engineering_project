{% extends "tennis/staff.html" %}

{% block title %}Knock Off : {{tournoi.nom}}{% endblock %}
{% block ongTournoi %}class="active"{% endblock %}

{% block bodyStaff %}
<!-- Gestionnaire des groupes -->
<div class="content-box" id="gestionTournoi">
    <h2 class="center" id="pageTitle">Choix des paires : {{tournoi.nom}}</h2>
    <hr class="line">

    <!-- Première étape selection des paires -->
    <div id="firstStep">
      <div class="row">
      {% for p in poules %}
      <div class="col-sm-4 panel-poule">
        <div class="panel panel-default">
          <div class="panel-heading">
            Poule {{p.id}}
          </div>
          <div class="list-group" id="{{p.id}}">
            {% for paire in p.SortedPair %}
            <a href="javascript:void(0)" onclick="checkBox('{{paire.id}}')" class="list-group-item">
              <div class="row">
                <div class="col-xs-10">
                  {{paire.user1.participant.smallName}}
                 &#38;
                  {{paire.user2.participant.smallName}} ({{paire.score}})
                </div>
                <div class="col-xs-2">
                  <input class="pull-right allBox {{p.id}}Box" type="checkbox" name="{{paire.id}}" id="ID{{paire.id}}" style="display:none">
                  <span class="{{p.id}}Check glyphicon glyphicon-unchecked" id="check{{paire.id}}" style="color:black"></span>
                </div>
              </div>
            </a>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endfor %}
      </div>
      <button type="button" class="btn btn-default center-block" onClick="firstModal()">Prochaine étape</button>
    </div>
    

    <!-- Deuxième étape set up de l'arbre -->
    <div id="secondStep" style="display:none">
      <div class="panel panel-default center-block" style="max-width:600px">
        <div class="panel-heading">Premier Round</div>
        <div class="panel-body" id="firstRoundBody">
          
        </div>
      </div>
      <button type="button" class="btn btn-default center-block" onClick="startTree()">Créer l'arbre du tournoi</button>
    </div>
  

    <!-- Div qui va contenir notre arbre -->
    <div id="TableArbre" style="display:none;">
      <div class="table-responsive">
        <div class="center-block" id="my_gracket"></div>
      </div>
		<form action="{% url "tennis.views.knockOff" tournoi.nom %}" method="post">
		{% csrf_token %}
      <ul class="list-inline text-center">
        <li>
          <button class="btn btn-default" onclick="sendTree()" value="save" name="action">Enregistrer</button>
        </li>
        <li>
          <button class="btn btn-default" data-toggle="modal" data-target="#deleteArbre" type="button">Supprimer</button>
        </li>
		 <input id="treeData" name="treeData" value="" style="display:none;">
		<input id="treeLabel" name="treeLabel" value="" style="display:none;">
		<input id="finaliste" name="finaliste" value="" style="display:none;">
		<input id="gagnant" name="gagnant" value="" style="display:none;">
	
		<button id="deleteTree" class="btn btn-default center-block" type="submit" style="display:none" value="deleteTree" name="action"></button>
      </ul>
		</form>
      
    </div>

    </div>
</div>

<!-- Modal première étape -->
  <div class="modal fade" id="firstModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title center">Etape 1</h4>
        </div>
        <div class="modal-body">
          <p>Continuer avec ces <number id="nombrePaire"></number> paires selectionnées?</p>
        
        <ul class="list-inline text-center">
        <li>
          <button type="button" class="btn btn-default" onclick="secondStep()">Confirmer</button>
        </li>
        <li>
          <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
        </li>
      </ul>
    </div>
      </div>
      
    </div>
  </div>

<!-- Modal set score arbre de tournoi -->
  <div class="modal fade" id="scoreModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title center">Score</h4>
        </div>
        <div class="modal-body">
          <form class="form-horizontal" action="">
            <p class="hint center" id="hintScore"></p>
            <!-- Equipe 1 -->
            <div class="form-group">
              <label class="control-label col-sm-7" for="team1" id="formteam1">Team 1</label>
              <div class="col-sm-2">
                <input type="number" class="form-control" id="inputTeam1" name="team1" style="text-align:center;" >
              </div>
            </div>

            <!-- Equipe 2 -->
            <div class="form-group">
              <label class="control-label col-sm-7" for="team2" id="formteam2">Team 2</label>
              <div class="col-sm-2">
                <input type="number" class="form-control" id="inputTeam2" name="team2" style="text-align:center;">
              </div>
            </div>

            <!-- Emplacement du match -->
            <input type="text" id="emplacement" style="display:none;">
          </form>
        
        <ul class="list-inline text-center">
        <li>
          <button type="button" class="btn btn-default" onclick="setScore()">Confirmer</button>
        </li>
        <li>
          <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
        </li>
      </ul>
    </div>
      </div>
      
    </div>
  </div>

<!-- Modal suppression arbre -->
  <div class="modal fade" id="deleteArbre" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title center">Confirmation de suppression</h4>
        </div>
        <div class="modal-body">
          <p>Etes vous sur de vouloir supprimer cet arbre de tournoi ?</p>
        
        <ul class="list-inline text-center">
        <li>
          <button type="button" class="btn btn-default" onclick="document.getElementById('deleteTree').click()">Confirmer</button>
        </li>
        <li>
          <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
        </li>
      </ul>
    </div>
      </div>
      
    </div>
  </div>

{% endblock %}

{% block commande %}
{% load static from staticfiles %}
<script src="{% static 'tennis/js/knockOut.js' %}" type="text/javascript"></script>

<script type="text/javascript">

{% if arbre %}
//on hide la première étape et on passe directement à l'arbre de tournoi
document.getElementById("firstStep").style.display = "none";
document.getElementById("TableArbre").style.display = "inherit";
document.getElementById("pageTitle").innerHTML = "Arbre du tournoi";
//Donnée de notre arbre
TreeData = JSON.parse('{{arbre.data|escapejs}}');

//label
TreeLabel = JSON.parse('{{arbre.label|escapejs}}');

setArbre(TreeData,TreeLabel);

{% endif %}
//Create an array with all paires
var allPaires = new Array();
{% for paire in allPaires %}
var Paire = {id:'pair{{paire.id}}',user1:'{{paire.user1.participant.smallName}}',user2:'{{paire.user2.participant.smallName}}',pos:'{{paire.position}}',poule:'{{paire.poule}}'}
allPaires[{{paire.id}}] = Paire;
{% endfor %}

//Set height of panel to have a nice display
var mesPanel = document.getElementsByClassName("panel-poule");
var height = 0;
for (var i = 0; i < mesPanel.length; i++) {
  var h = mesPanel[i].offsetHeight;
  if(h>height){
    height = h;
  }
};
for (var i = 0; i < mesPanel.length; i++) {
  mesPanel[i].style.minHeight = height+"px";
};

//Check the two first box of each panel if it doesn't exceed 16
var nombrePanel = mesPanel.length;
if(nombrePanel<17){
  {% for p in poules %}
  var pouleBoxes = document.getElementsByClassName({{p.id}}+"Box");
  var pouleCheck = document.getElementsByClassName({{p.id}}+"Check");
  if(nombrePanel>8 || pouleBoxes.length<2){
    pouleBoxes[0].checked = true;
    pouleCheck[0].className = "glyphicon glyphicon-check"
  }else{
    pouleBoxes[0].checked = true;
    pouleBoxes[1].checked = true;
    pouleCheck[0].className = "glyphicon glyphicon-check"
    pouleCheck[1].className = "glyphicon glyphicon-check"
  }
  {% endfor %}
}
</script>

{% endblock %}
    
