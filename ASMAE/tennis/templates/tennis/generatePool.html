{% extends "tennis/staff.html" %}

{% block title %}{{ tournoi.nom }}{% endblock %}
{% block ongTournoi %}class="active"{% endblock %}

{% block bodyStaff %}
<!-- Gestionnaire des groupes -->
<div class="content-box" id="gestionTournoi">
    <h2 class="center">{{ tournoi.nom }}</h2>
    <hr class="line">
    <form class="form-horizontal" action="">
        <div class="panel panel-default">
            <div class="panel-heading">Configuration</div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-sm-4">
                        <label class="control-label col-sm-10">Nombre de paires</label>
                        <div class="col-sm-2">
                            <p class="info">{{ pair|length }}</p>
                        </div>
                        <label class="control-label col-sm-10">Nombre de terrains disponible</label>
                        <div class="col-sm-2">
                            <p class="info">{{ nbrTerrains }}</p>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <label class="control-label col-sm-8">Nombre de poules</label>
                        <div class="col-sm-4">
                            <input class="form-control" style="min-width:50px;max-width:100px;" type="number" value="{{ defaultValue }}" id="poulesNumber">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <label class="control-label col-sm-8">Taille des poules</label>
                        <div class="col-sm-4">
                            <input class="form-control" style="min-width:50px;max-width:100px;" type="number" value="6" id="poulesSize">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    

    <div class="row" style="margin-top:20px;" id="poulesDiv">
        <!--
        {% for key, paires in pairListAll.items %}
        <div class="col-lg-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <label class="control-label col-xs-4">Poule {{ key }}</label>
                        <div class="col-xs-8">
                            <select class="form-control" name="Leader" id="Leader{{key}}">
                                <option disabled selected>Choisir un leader</option>
                                {% for elem in paires %}
                                <option value="{{ elem.user1.participant.prenom }} {{ elem.user1.participant.nom }}">{{ elem.user1.participant.prenom }} {{ elem.user1.participant.nom }}</option>
                                <option value="{{ elem.user2.participant.prenom }} {{ elem.user2.participant.nom }}">{{ elem.user2.participant.prenom }} {{ elem.user2.participant.nom }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                    </div>
                </div>
                <div class="list-group">
                    {% for elem in paires %}
                    <div class="dropBox" ondragover="allowDrop(event)" ondrop="drop(event)" style="padding-left:10px;padding-right:10px;padding-top:3px; padding-bottom:3px;">
                        <div id="{{ elem.id }}" draggable="true" ondragstart="drag(event)">
                            <div class="zone">
                                <div class="row">
                                    <div class="col-xs-10">
                                        <b style="color:#222">
                                        {% if elem.user1.participant.titre == "Mr" %}
                                        <i class="fa fa-male"></i> 
                                        {% else %}
                                        <i class="fa fa-female"></i>
                                        {% endif %}
                                        </b> {{ elem.user1.participant.prenom }} {{ elem.user1.participant.nom }} ({{ elem.user1.age }} ans)<br>
                                        <b style="color:#222">
                                        {% if elem.user2.participant.titre == "Mr" %}
                                            <i class="fa fa-male"></i>
                                            {% else %}
                                            <i class="fa fa-female"></i>
                                            {% endif %}
                                        </b> {{ elem.user2.participant.prenom }} {{ elem.user2.participant.nom }} ({{ elem.user2.age }} ans)
                                    </div>
                                    <div class="col-xs-2">
                                        {% if elem.commentaires %}
                                        <a href="javascript:void(0);" data-toggle="popover" data-html="true" data-placement="left" data-content="{{ elem.commentaires }}">
                                            <b style="color:#222;"><i class="fa fa-file-text-o fa-2x"></i></b>
                                        </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    {% if key == defaultValue %}
                        {% for elem in complement %}
                        <div class=" dropBox" ondragover="allowDrop(event)" ondrop="drop(event)" style="padding-left:10px;padding-right:10px;padding-top:3px; padding-bottom:3px;">
                            <div id="bidon{{elem}}" draggable="true" ondragstart="drag(event)">
                            <p class="zone"> <br><br></p>
                        </div>
                        </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    -->
    </div>
        <ul class="list-inline text-center" style="padding-top:10px">
            <li>
                <button class="btn btn-default center-block" type="button">Sauvegarder</button>
            </li>
            <li>
                <button class="btn btn-default center-block" data-toggle="modal" data-target="#myModal" type="button">Valider et envoyer les mails</button>
            </li>
        </ul>
    </form>
</div>

<!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title center">Confirmation validation</h4>
        </div>
        <div class="modal-body">
          <p>Etes-vous sûr de valider la formations des groupes de ce tournoi et envoyer les mails aux utilisateurs concernés?</p>
        
            <ul class="list-inline text-center">
                <li>
                    <button type="button" class="btn btn-default" onclick="">oui</button>
                </li>
                <li>
                    <button type="button" class="btn btn-default" data-dismiss="modal">non</button>
                </li>
            </ul>
        </div>
      </div>
      
    </div>
  </div>

{% endblock %}


{% block commande %}
{% load static from staticfiles %}
<script src="{% static 'tennis/js/poules.js' %}" type="text/javascript"></script>

<script>

//Creation de la liste des paires
var PairList = [] ;
var TerrainList = [];

{% for elem in allPair %}

var nom1 = '{{ elem.user1.participant.prenom }}' +" "+'{{ elem.user1.participant.nom }}';
var nom2 = '{{ elem.user2.participant.prenom }}'+" "+'{{ elem.user2.participant.nom }}';

var p = {id:'{{elem.id}}',user1:nom1,user2:nom2,age1:'{{elem.user1.age}}',age2:'{{elem.user2.age}}',comment:'{{elem.commentaires}}',titre1:'{{elem.user1.participant.titre}}',titre2:'{{elem.user2.participant.titre}}'};
PairList.push(p);

{% endfor %}
{% for elem in listTerrains %}
var addr = '{{elem.rue}}'+ " ,"+'{{elem.numero}}'+"<br>"+'{{elem.codepostal}}'+ " "+'{{elem.localite}}';
TerrainList.push({id:'{{elem.id}}', user:'{{elem.user.participant.nom}}',matiere:'{{elem.matiere}}',addr:addr})

{% endfor %}

//on ajout la liste des pair dans le cache
setPairList(PairList,TerrainList);

//On set les poules pour en avoir max 6 par poules
setPoules({{defaultValue}});
//updatePanel(1);

//Listener sur le nombre de pair
$('#poulesNumber').on('input', function() { 
    var nbr = document.getElementById("poulesNumber").value;
    setPoules(nbr);
});

//Listener sur le size des poules
$('#poulesSize').on('input', function() { 
    /*
    var nbr = document.getElementById("poulesSize").value;
    var poules = Math.ceil(PairList.length/nbr);
    setPoules(poules);
    */
    var nbr = document.getElementById("poulesSize").value;
    setPoules2(nbr);
});
</script>
{% endblock %}
    
